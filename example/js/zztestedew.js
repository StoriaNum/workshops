var CameraButtons=function(e){function t(){$("#zoom-in").click(a),$("#zoom-out").click(d),$("#zoom-in").dblclick(l),$("#zoom-out").dblclick(l),$("#reset-view").click(n.centerCamera),$("#move-left").click(function(){o(i.LEFT)}),$("#move-right").click(function(){o(i.RIGHT)}),$("#move-up").click(function(){o(i.UP)}),$("#move-down").click(function(){o(i.DOWN)}),$("#move-left").dblclick(l),$("#move-right").dblclick(l),$("#move-up").dblclick(l),$("#move-down").dblclick(l)}function l(e){e.preventDefault(),e.stopPropagation()}function o(e){switch(e){case i.UP:r.panXY(0,s);break;case i.DOWN:r.panXY(0,-s);break;case i.LEFT:r.panXY(s,0);break;case i.RIGHT:r.panXY(-s,0)}}function a(e){e.preventDefault(),r.dollyIn(1.1),r.update()}function d(e){e.preventDefault,r.dollyOut(1.1),r.update()}var r=e.three.controls,n=e.three,s=30,i={UP:1,DOWN:2,LEFT:3,RIGHT:4};t()},ContextMenu=function(e){function t(){$("#context-menu-delete").click(function(e){s.remove()}),i.itemSelectedCallbacks.add(a),i.itemUnselectedCallbacks.add(n),r(),$("#fixed").click(function(){var e=$(this).prop("checked");s.setFixed(e)})}function l(e){return e}function o(e){return e}function a(e){s=e,$("#context-menu-name").text(e.metadata.itemName);var t=""+e.metadata.modelGallery;document.getElementById("modelGallerylink").href=t,$("#modelPricetot").text(e.metadata.modelPrice);var o=""+e.metadata.modelPrice,a=""+e.metadata.modelBuybasket;document.getElementById("modelBuybasketlink").href=a;var d=""+e.metadata.modelBuybasket;document.getElementById("modelBuybasketlink2").href=d,"NOT-ON-SALE"===o?(document.getElementById("modelGallerylink").style.display="none",document.getElementById("prez").setAttribute("hidden",!0),document.getElementById("infoiva").setAttribute("hidden",!0),document.getElementById("modelPricetot").setAttribute("hidden",!0),document.getElementById("modelBuybasketlink").style.display="none",document.getElementById("modelBuybasketlink2").style.display="none",document.getElementById("item-width").removeAttribute("readonly"),document.getElementById("item-depth").removeAttribute("readonly"),document.getElementById("item-height").removeAttribute("readonly"),document.getElementById("contentdimens").innerHTML="Varia Dimensione",document.getElementById("namecodeitem").style.display="none",document.getElementById("panelcustomitem").className="panel panel-default"):"CUSTOM:A-RICHIESTA"===o?($("#modelGallerylink").show(),document.getElementById("prez").removeAttribute("hidden"),document.getElementById("modelPricetot").removeAttribute("hidden"),document.getElementById("infoiva").setAttribute("hidden",!0),$("#modelBuybasketlink2").show(),document.getElementById("namecodeitem").href="http://mediametalli.altervista.org/sweetmodalalert/emailbox/promptit.html?Arredo="+e.metadata.itemName,document.getElementById("namecodeitem").style.display="none",document.getElementById("modelBuybasketlink").style.display="none",document.getElementById("item-width").removeAttribute("readonly"),document.getElementById("item-depth").removeAttribute("readonly"),document.getElementById("item-height").removeAttribute("readonly"),document.getElementById("contentdimens").innerHTML="<b>Inserisci le tue misure personalizzate</b>",document.getElementById("panelcustomitem").className="panel panel-danger"):($("#modelGallerylink").show(),document.getElementById("prez").removeAttribute("hidden"),document.getElementById("infoiva").removeAttribute("hidden"),document.getElementById("modelPricetot").removeAttribute("hidden"),$("#modelBuybasketlink").show(),document.getElementById("modelBuybasketlink2").style.display="none",document.getElementById("item-width").setAttribute("readonly",!0),document.getElementById("item-depth").setAttribute("readonly",!0),document.getElementById("item-height").setAttribute("readonly",!0),document.getElementById("contentdimens").innerHTML="Dimensione Oggetto",document.getElementById("namecodeitem").style.display="none",document.getElementById("panelcustomitem").className="panel panel-default"),$("#item-width").val(l(s.getWidth()).toFixed(0)),$("#item-height").val(l(s.getHeight()).toFixed(0)),$("#item-depth").val(l(s.getDepth()).toFixed(0)),$("#context-menu").show(),$("#fixed").prop("checked",e.fixed)}function d(){s.resize(o($("#item-height").val()),o($("#item-width").val()),o($("#item-depth").val()))}function r(){$("#item-height").change(d),$("#item-width").change(d),$("#item-depth").change(d)}function n(){s=null,$("#context-menu").hide()}var s,i=e.three;t()},ModalEffects=function(e){function t(){o>0?$("#loading-modal").show():$("#loading-modal").hide()}function l(){e.model.scene.itemLoadingCallbacks.add(function(){o+=1,t()}),e.model.scene.itemLoadedCallbacks.add(function(){o-=1,t()}),t()}var e=e,o=0;this.setActiveItem=function(e){itemSelected=e,t()},l()},SideMenu=function(e,t,l){function o(){for(var t in c){var l=c[t];l.click(d(l))}$("#update-floorplan").click(a),n(),e.three.updateWindowSize(),s(),i(),r(u.states.DEFAULT)}function a(){r(u.states.DEFAULT)}function d(t){return function(){e.three.stopSpin();for(var l in u.states){var o=u.states[l];if(o.tab==t){r(o);break}}}}function r(l){b!=l&&(b.tab!==l.tab&&(null!=b.tab&&b.tab.removeClass(m),null!=l.tab&&l.tab.addClass(m)),e.three.getController().setSelectedObject(null),b.div.hide(),l.div.show(),l==u.states.FLOORPLAN&&(t.updateFloorplanView(),t.handleWindowResize()),b==u.states.FLOORPLAN&&e.model.floorplan.update(),l==u.states.DEFAULT&&e.three.updateWindowSize(),s(),b=l,u.stateChangeCallbacks.fire(l))}function n(){$(window).resize(s),s()}function s(){$(".sidebar").height(window.innerHeight),$("#add-items").height(window.innerHeight),$("#add-items_0").height(window.innerHeight),$("#add-items_1").height(window.innerHeight),$("#add-items_2").height(window.innerHeight),$("#add-items_3").height(window.innerHeight),$("#add-items_4").height(window.innerHeight),$("#add-items_5").height(window.innerHeight)}function i(){$("#add-items,#add-items_0,#add-items_1,#add-items_2,#add-items_3,#add-items_4,#add-items_5").find(".add-item, .add-item_0, .add-item_1, .add-item_2, .add-item_3, .add-item_4, .add-item_5").mousedown(function(t){var l=$(this).attr("model-url"),o=parseInt($(this).attr("model-type")),a=$(this).attr("model-price"),d=$(this).attr("model-buybasket"),n=$(this).attr("model-gallery"),s={itemName:$(this).attr("model-name"),resizable:!0,modelUrl:l,modelPrice:a,modelBuybasket:d,modelGallery:n,itemType:o};e.model.scene.addItem(o,l,a,d,n,s),r(u.states.DEFAULT)})}var e=e,t=t,m="active",c={FLOORPLAN:$("#floorplan_tab"),SHOP:$("#items_tab"),SHOP_0:$("#items_tab_0"),SHOP_1:$("#items_tab_1"),SHOP_2:$("#items_tab_2"),SHOP_3:$("#items_tab_3"),SHOP_4:$("#items_tab_4"),SHOP_5:$("#items_tab_5"),DESIGN:$("#design_tab")},u=this;this.stateChangeCallbacks=$.Callbacks(),this.states={DEFAULT:{div:$("#viewer"),tab:c.DESIGN},FLOORPLAN:{div:$("#floorplanner"),tab:c.FLOORPLAN},SHOP_0:{div:$("#add-items_0"),tab:c.SHOP_0},SHOP_1:{div:$("#add-items_1"),tab:c.SHOP_1},SHOP_2:{div:$("#add-items_2"),tab:c.SHOP_2},SHOP_3:{div:$("#add-items_3"),tab:c.SHOP_3},SHOP_4:{div:$("#add-items_4"),tab:c.SHOP_4},SHOP_5:{div:$("#add-items_5"),tab:c.SHOP_5},SHOP:{div:$("#add-items"),tab:c.SHOP}};var b=u.states.FLOORPLAN;o()},TextureSelector=function(e,t){function l(){$(".texture-select-thumbnail").click(function(e){var t=$(this).attr("texture-url"),l="true"==$(this).attr("texture-stretch"),o=parseInt($(this).attr("texture-scale"));s.setTexture(t,l,o),e.preventDefault()})}function o(){n.wallClicked.add(a),n.floorClicked.add(d),n.itemSelectedCallbacks.add(r),n.nothingClicked.add(r),t.stateChangeCallbacks.add(r),l()}function a(e){s=e,$("#floorTexturesDiv").hide(),$("#wallTextures").show()}function d(e){s=e,$("#wallTextures").hide(),$("#floorTexturesDiv").show()}function r(){$("#wallTextures").hide(),$("#floorTexturesDiv").hide()}var n=e.three,s=null;o()},ViewerFloorplanner=function(e){function t(){$(window).resize(n.handleWindowResize),n.handleWindowResize(),n.floorplanner.modeResetCallbacks.add(function(e){$(d).removeClass(r),$(a).removeClass(r),$(o).removeClass(r),e==n.floorplanner.modes.MOVE?$(o).addClass(r):e==n.floorplanner.modes.DRAW?$(d).addClass(r):e==n.floorplanner.modes.DELETE&&$(a).addClass(r),e==n.floorplanner.modes.DRAW?($("#draw-walls-hint").show(),n.handleWindowResize()):$("#draw-walls-hint").hide()}),$(o).click(function(){n.floorplanner.setMode(n.floorplanner.modes.MOVE)}),$(d).click(function(){n.floorplanner.setMode(n.floorplanner.modes.DRAW)}),$(a).click(function(){n.floorplanner.setMode(n.floorplanner.modes.DELETE)})}var l="#floorplanner",o="#move",a="#delete",d="#draw",r="btn-primary disabled";this.floorplanner=e.floorplanner;var n=this;this.updateFloorplanView=function(){n.floorplanner.reset()},this.handleWindowResize=function(){$(l).height(window.innerHeight-$(l).offset().top),n.floorplanner.resizeView()},t()},mainControls=function(e){function t(){e.model.loadSerialized('{"floorplan":{"corners":{"f90da5e3-9e0e-eba7-173d-eb0b071e838e":{"x":204.85099999999989,"y":289.052},"da026c08-d76a-a944-8e7b-096b752da9ed":{"x":672.2109999999999,"y":289.052},"4e3d65cb-54c0-0681-28bf-bddcc7bdb571":{"x":672.2109999999999,"y":-178.308},"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2":{"x":204.85099999999989,"y":-178.308}},"walls":[{"corner1":"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2","corner2":"f90da5e3-9e0e-eba7-173d-eb0b071e838e","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}},{"corner1":"f90da5e3-9e0e-eba7-173d-eb0b071e838e","corner2":"da026c08-d76a-a944-8e7b-096b752da9ed","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}},{"corner1":"da026c08-d76a-a944-8e7b-096b752da9ed","corner2":"4e3d65cb-54c0-0681-28bf-bddcc7bdb571","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}},{"corner1":"4e3d65cb-54c0-0681-28bf-bddcc7bdb571","corner2":"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}}],"wallTextures":[],"floorTextures":{},"newFloorTextures":{}},"items":[]}')}function l(){files=$("#loadFile").get(0).files;var t=new FileReader;t.onload=function(t){var l=t.target.result;e.model.loadSerialized(l)},t.readAsText(files[0])}function o(){var t=e.model.exportSerialized(),l=window.document.createElement("a"),o=new Blob([t],{type:"text"});l.href=window.URL.createObjectURL(o),l.download="design.storiablue",document.body.appendChild(l),l.click(),document.body.removeChild(l)}function a(){$("#new").click(t),$("#loadFile").change(l),$("#saveFile").click(o)}var e=e;a()};$(document).ready(function(){var e={floorplannerElement:"floorplanner-canvas",threeElement:"#viewer",threeCanvasElement:"three-canvas",textureDir:"models/textures/",widget:!1},t=new Blueprint3d(e),l=new ModalEffects(t),o=new ViewerFloorplanner(t),a=(new ContextMenu(t),new SideMenu(t,o,l));new TextureSelector(t,a),new CameraButtons(t);mainControls(t),data='{"floorplan":{"corners":{"56d9ebd1-91b2-875c-799d-54b3785fca1f":{"x":630.555,"y":-227.58400000000006},"8f4a050d-e102-3c3f-5af9-3d9133555d76":{"x":294.64,"y":-227.58400000000006},"4e312eca-6c4f-30d1-3d9a-a19a9d1ee359":{"x":294.64,"y":232.664},"254656bf-8a53-3987-c810-66b349f49b19":{"x":745.7439999999998,"y":232.664},"11d25193-4411-fbbf-78cb-ae7c0283164b":{"x":1044.7019999999998,"y":232.664},"edf0de13-df9f-cd6a-7d11-9bd13c36ce12":{"x":1044.7019999999998,"y":-105.66399999999999},"e7db8654-efe1-bda2-099a-70585874d8c0":{"x":745.7439999999998,"y":-105.66399999999999}},"walls":[{"corner1":"4e312eca-6c4f-30d1-3d9a-a19a9d1ee359","corner2":"254656bf-8a53-3987-c810-66b349f49b19","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap_yellow.png","stretch":true,"scale":null}},{"corner1":"254656bf-8a53-3987-c810-66b349f49b19","corner2":"e7db8654-efe1-bda2-099a-70585874d8c0","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap_yellow.png","stretch":true,"scale":null}},{"corner1":"56d9ebd1-91b2-875c-799d-54b3785fca1f","corner2":"8f4a050d-e102-3c3f-5af9-3d9133555d76","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap_yellow.png","stretch":true,"scale":null}},{"corner1":"8f4a050d-e102-3c3f-5af9-3d9133555d76","corner2":"4e312eca-6c4f-30d1-3d9a-a19a9d1ee359","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap_yellow.png","stretch":true,"scale":null}},{"corner1":"254656bf-8a53-3987-c810-66b349f49b19","corner2":"11d25193-4411-fbbf-78cb-ae7c0283164b","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}},{"corner1":"11d25193-4411-fbbf-78cb-ae7c0283164b","corner2":"edf0de13-df9f-cd6a-7d11-9bd13c36ce12","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/light_brick.jpg","stretch":false,"scale":100}},{"corner1":"edf0de13-df9f-cd6a-7d11-9bd13c36ce12","corner2":"e7db8654-efe1-bda2-099a-70585874d8c0","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0}},{"corner1":"e7db8654-efe1-bda2-099a-70585874d8c0","corner2":"56d9ebd1-91b2-875c-799d-54b3785fca1f","frontTexture":{"url":"rooms/textures/wallmap.png","stretch":true,"scale":0},"backTexture":{"url":"rooms/textures/wallmap_yellow.png","stretch":true,"scale":null}}],"wallTextures":[],"floorTextures":{},"newFloorTextures":{"11d25193-4411-fbbf-78cb-ae7c0283164b,254656bf-8a53-3987-c810-66b349f49b19,e7db8654-efe1-bda2-099a-70585874d8c0,edf0de13-df9f-cd6a-7d11-9bd13c36ce12":{"url":"rooms/textures/light_fine_wood.jpg","scale":300}}},"items":[{"item_name":"Poster-Quadro-Foto","item_type":2,"model_url":"models/js/nyc-poster2.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":1038.448276049687,"ypos":146.36650685131218,"zpos":127.2945944810669,"rotation":-1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Tappeto","item_type":8,"model_url":"models/js/cb-blue-block-60x96.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":914.5788405991636,"ypos":0.25000500000000003,"zpos":-14.898755542411582,"rotation":-1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Porta Aperta","item_type":7,"model_url":"models/js/open_door.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":745.2440185546875,"ypos":110.800000297771,"zpos":44.39619550122137,"rotation":-1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Porta Chiusa","item_type":7,"model_url":"models/js/closed-door28x80_baked.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":647.9801837450683,"ypos":110.80000022010701,"zpos":232.16400146484375,"rotation":3.141592653589793,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Comodino Colore Bianco","item_type":1,"model_url":"models/js/cb-archnight-white_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":1003.0792739860971,"ypos":31.15939942141,"zpos":94.15927688133303,"rotation":-1.0371121156528549,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Comò Colore Bianco","item_type":1,"model_url":"models/js/we-narrow6white_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":891.2265247159877,"ypos":35.611997646165,"zpos":201.4265158740954,"rotation":3.141592653589793,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Letto Matrimoniale","item_type":1,"model_url":"models/js/ik_nordli_full.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":936.9990764934029,"ypos":50,"zpos":-16.63277266683859,"rotation":-1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Postazione Multimediale Colore Bianco","item_type":1,"model_url":"models/js/cb-clapboard_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":667.566835099473,"ypos":67.88999754395999,"zpos":-142.46296101235313,"rotation":-0.8105717780726251,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Tavolo Ellittico","item_type":1,"model_url":"models/js/ik-stockholmcoffee-brown.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":466.14057540460857,"ypos":24.01483158034958,"zpos":-18.17309413606685,"rotation":1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Lampada da Pavimento","item_type":1,"model_url":"models/js/ore-3legged-white_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":342.73036739933065,"ypos":72.163997943445,"zpos":-175.06047825165658,"rotation":0,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Libreria","item_type":1,"model_url":"models/js/cb-kendallbookcasewalnut_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":522.2361255174952,"ypos":92.17650034119151,"zpos":208.12632343609533,"rotation":-3.141592653589793,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Sedia Colore Rosso","item_type":1,"model_url":"models/js/ik-ekero-orange_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":390.3885893585605,"ypos":37.50235073007,"zpos":160.87345065615892,"rotation":2.296471887702932,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Finestra","item_type":3,"model_url":"models/js/whitewindow.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":295.1400146484375,"ypos":141.4467085442696,"zpos":134.84916806910527,"rotation":1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Finestra","item_type":3,"model_url":"models/js/whitewindow.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":371.2547417297926,"ypos":138.22343858503913,"zpos":-227.08399963378906,"rotation":0,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Finestra","item_type":3,"model_url":"models/js/whitewindow.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":526.4108365303404,"ypos":138.7004920791722,"zpos":-227.08399963378906,"rotation":0,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Finestra","item_type":3,"model_url":"models/js/whitewindow.js","model_price":"NOT-ON-SALE","model_buybasket":"","model_gallery":"#","xpos":890.2965221236178,"ypos":132.79681150755556,"zpos":-105.16400146484375,"rotation":0,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false},{"item_name":"Divano Colore Grigio","item_type":1,"model_url":"models/js/cb-rochelle-gray_baked.js","model_price":"x,y €","model_buybasket":"","model_gallery":"#","xpos":358.66510029784695,"ypos":42.54509923821,"zpos":-19.957301718916085,"rotation":1.5707963267948966,"scale_x":1,"scale_y":1,"scale_z":1,"fixed":false}]}',t.model.loadSerialized(data)});
